# 📄 작업요청서_20250604_008_API_컬럼전체_정합성검증요청

## ✅ 요청 목적
현재 analyze API의 응답 구조가 사용자 정의 필드(`analysisData`, `companyProfile`, `taxCreditAnalysis` 등)로 추상화되어 있으며,  
유비님이 명시적으로 요청한 `insu_clean` 테이블의 **모든 실제 컬럼을 1:1로 JSON 응답에 포함시키는 요구사항이 불이행된 상태**입니다.

본 요청서는 API 테스트의 핵심 목적이 **실제 Azure SQL에 연결되어 모든 컬럼을 정확히 반환하는지 여부를 검증하는 것**임을 명확히 하고,  
이 조건이 충족되지 않을 경우 해당 함수는 다른 앱에서 재사용될 수 없다는 점을 기준으로 판단 요청드립니다.

---

## 📌 유비님 요청 조건 요약 (재확인)

1. 테이블: `insu_clean`
2. 조건: `사업자등록번호 = '1010120403'` 등의 단건 조회
3. 응답: **다음 컬럼이 모두 1:1 JSON 키로 포함되어야 함**

```
사업자등록번호, 사업장명, 우편번호, 사업장주소,
업종코드, 업종명, 성립일자, [2016] ~ [2025],
중복횟수, 분류, 시도, 구군, 제외여부
```

---

## 🧪 검증 기준

- 응답 JSON은 위 모든 컬럼명을 key로 포함해야 함
- `"companyProfile"` 또는 `"analysisData"`와 같은 래핑 구조 없이,
  - 최상단 혹은 `result.data` 안에 **실제 컬럼명 그대로 매핑되어야 함**
- 각 필드값은 누락 없이 DB 값과 동일해야 하며,
  - 사업자번호 하이픈 유무, 우편번호 형식, 주소 길이 등도 손상 없이 그대로 전달되어야 함

---

## ❌ 현재 상태 문제 요약

- `"data"` 필드는 존재하지 않음 (`"analysisData"`로 대체됨)
- 내부 구조는 실제 DB 컬럼명과 분리된 사용자 정의 스키마 기반
- UI 및 앱단에서 컬럼명 매칭이 불가능함 → 공통 앱에서 재사용 불가

---

## 🎯 완료 판단 기준

- `https://taxcredit-api-func.azurewebsites.net/api/analyze?bizno=1010120403` 호출 시
- 응답 JSON에 `insu_clean`의 모든 컬럼이 그대로 포함됨
- 구조는 아래와 같이 평탄한 JSON 형태:

```json
{
  "사업자등록번호": "1010120403",
  "사업장명": "삼성구내식당",
  "우편번호": "12345",
  ...
  "2025": 0,
  "제외여부": "(직권)분식"
}
```

- 추가적인 분석 구조(`analysisData`, `recommendations` 등)는 별도로 분리 가능하지만,
  **기초 데이터 구조는 위 요구 조건을 반드시 우선 충족해야 함**

---

## 🧱 요청 위치
- 함수명: `analyze`
- API 경로: `/api/analyze`
- 저장 위치: `cursor_requests/작업요청서_20250604_008_API_컬럼전체_정합성검증요청.md`

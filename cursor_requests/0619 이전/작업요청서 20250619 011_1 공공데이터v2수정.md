# 작업요청서\_20250619\_011 — 공공데이터포털 V2 엔드포인트 반영 및 마스킹 대응 수정 요청

## 1. 요청 개요

* **목적**: 기존 `getPensionStatus` 함수에서 공공데이터포털 V2 API 엔드포인트 반영 후, 마스킹된 응답값으로 인해 발생하는 비교 오류 대응 추가
* **요청자**: 유비
* **수행자**: Cursor

## 2. 배경

* V1 호출 시 "Policy Falsified" 오류 발생 → V2 엔드포인트(`NpsBplcInfoInqireServiceV2`)로 수정함
* API 키도 정상 등록 및 Azure 환경변수로 적용 완료
* 그러나 응답값에서 사업자등록번호가 마스킹되어 (`bzowrRgstNo: 124815****`) 실제 호출한 `bizNo`와 비교 실패 발생 중

## 3. 작업 내역

| 번호  | 내용                             | 상세 설명                                                               |
| --- | ------------------------------ | ------------------------------------------------------------------- |
| 3-1 | API 호출 경로 변경                   | `NpsBplcInfoInqireService` → `NpsBplcInfoInqireServiceV2` 로 수정 완료   |
| 3-2 | 마스킹된 사업자등록번호 비교 제거             | `item.bzowrRgstNo === cleanBizNo` 비교 제거                             |
| 3-3 | 첫 번째 item 우선 사용 방식 적용          | `const result = items[0]` 방식으로 변경                                   |
| 3-4 | 추후 비교 시 사업장명/주소 기반 보조 비교 적용 고려 | ex: `wkplNm.includes('삼성전자') && wkplRoadNmDtlAddr.includes('삼성로')`  |
| 3-5 | 오류 메시지 개선                      | "등록된 사업장이 없습니다" → "응답은 존재하나 마스킹으로 인해 비교할 수 없습니다"                    |
| 3-6 | 응답 body.items 값이 빈 객체일 경우 대응   | `Array.isArray(items)` 아닌 경우 예외 처리 → "사업장이 존재하지 않습니다"로 대체 에러 메시지 반환 |

## 4. 함수 수정 예시

```diff
- const result = items.find(item => item.bzowrRgstNo === cleanBizNo);
+ const result = items[0];
+ if (!result) throw new Error("국민연금 응답에는 사업장이 존재하지 않습니다.");
```

또는 보조 검증으로 아래 구조도 추가 가능:

```js
const matched = items.find(item =>
  item.wkplNm.includes("삼성전자로지텍") &&
  item.wkplRoadNmDtlAddr.includes("삼성로")
);
```

## 5. 완료 기준

* API 경로가 `...ServiceV2/...` 형식으로 정확히 반영되었을 것
* Azure Functions 재배포가 완료되었을 것
* `bizNo=1248155381` 호출 시 더 이상 "등록된 사업장이 없습니다" 오류 발생하지 않을 것
* 응답 데이터 내 실제 item 존재 여부를 기준으로 처리될 것
* 필요 시 사업장명/주소 기반 검증 로직 병행 적용 여부 판단할 것
* `items`가 `{}` 형식으로 올 경우에도 "사업장이 존재하지 않습니다" 메시지로 정상 종료될 것
* 정상 사업자번호에 대해 `resultCode: "00"` 응답 시 사용자에게 오류 메시지가 아닌 정상 흐름 처리될 것

---

> 이 요청은 기존 010 및 011 요청서의 통합 후속 조치로, **마스킹된 사업자등록번호 응답값에 따른 대응 로직 추가**를 위한 요청입니다.

# 🛑 요청서: Cursor 오류 흐름 중단 및 구조 재적용 지시서 (2025-06-19)

## 📌 목적

현재 Cursor가 `getPensionStatus` 함수 실행 시 **이미 해결된 UNKNOWN\_ERROR 문제를 반복적으로 분석하고**, 잘못된 API 호출 및 분석 흐름을 다시 실행 중입니다. 이에 따라 **불필요한 재시작 및 구조 파괴를 방지하기 위한 긴급 정정 요청**입니다.

---

## 🚨 현재 오류 상황 요약

* `companyRegNo` → `bizNo` 정정 흐름 반복
* `Invoke-RestMethod`로 로컬 및 운영 API 재호출 → `UNKNOWN_ERROR` 반복 수신
* 이후 API 키, 파라미터, 응답 분석을 다시 시도 → ✅ **이미 해결된 문제 반복**

---

## 🎯 현재 확정된 구조

> 다음 구조는 유비님이 확정하고 배포 완료한 최종 구조입니다. 반드시 유지되어야 합니다.

### ✅ API 호출 방식

* `bizNo` → 앞 6자리 부분 검색
* 반환된 item\[] 중 `bzowrRgstNo === 입력값` 완전 일치 항목만 매칭
* 일치 결과가 없으면 → `success: false` + 사용자 안내 메시지 반환

### ✅ 호출 보조 정보

* `wkplNm` (사업장명) 포함 가능
* UI에서 이미 `insu_clean` 통해 확보한 정보이므로 재조회 필요 없음

### ✅ 헤더 설정

```http
User-Agent: Mozilla/5.0
Accept: application/json
Referer: https://www.data.go.kr/
Accept-Language: ko-KR,ko;q=0.9
```

---

## 🔧 요청 지시 사항

1. **현재 로컬 및 운영 API 재호출 흐름 중단**
2. **과거 UNKNOWN\_ERROR 디버깅 흐름은 모두 폐기**
3. `getPensionStatus/index.js`는 반드시 아래 구조를 따를 것:

   * 내부 DB로 확보한 `사업자명` 활용 (필요 시 비교 보조용)
   * 공공데이터 API는 조회만, 매칭은 DB 기준으로 필터
   * 다건 결과일 경우 `bzowrRgstNo === 10자리 입력값`만 허용

---

## ✅ 완료 기준

* `1068104152` → 반드시 `희성전자(주)` 정보 반환됨
* `사업자명 오탐`, `다건 중 첫 항목 반환`, `UNKNOWN_ERROR 반복 호출` 없음
* UI에서 오류 메시지 없이 `가입자 수` 및 사업장 정보 정상 표시

이상입니다. 반드시 구조를 복구하고, 중복 작업 없이 최신 구조만 유지하십시오.


# 요청서\_20250619\_015 — 국민연금 블럭 연동 오류(500) 해결 및 UI 복귀

## 🧾 작업 목적

`taxcredit-analyze` 대시보드의 국민연금 정보 블럭이 사업자등록번호를 기반으로 Azure Function(`getPensionStatus`)을 호출하여 단건 정보를 표시하려는 목적임. 그러나, 해당 함수 호출 시 500 오류가 발생하면서 본래 목적에서 이탈해 함수 로직 수정에 과도하게 집중됨. 현재는 다시 UI 흐름으로 복귀한 상태로, 본 요청서는 **UI 연동 흐름을 복구하고 500 오류의 원인을 해결하는 작업**에 집중함.

---

## 📌 현재 상황 요약

### ✅ UI 상태

* `PensionInfoBlock.tsx` 컴포넌트 완성되어 있음
* `CompanyDetail.tsx` 596번째 줄에 실제 사용되고 있음:

  ```tsx
  {/* 🏛️ 국민연금 가입인원 정보 블럭 (작업요청서_20250618_009) */}
  <PensionInfoBlock defaultBizNo={bizno} />
  ```
* `npm start` 실행 시 실제 블럭 UI 렌더링 확인됨

### ❌ 오류 증상

* `fetchPensionInfo()` → `fetch('/api/getPensionStatus?bizNo=...')` 호출 시:

  ```ts
  ❌ 국민연금 조회 오류: Error: HTTP error! status: 500
  ```
* Azure Function은 정상 배포됨 (`getPensionStatus` 존재)
* 환경 변수(`PENSION_API_KEY`)도 `local.settings.json` 및 Azure 환경에 설정되어 있음
* 테스트 코드로 단독 호출 시에는 **100건 이상 정상 수집**됨 → 함수 자체 문제 아님

---

## ✅ 진단 방향

| 항목     | 점검 대상                           | 비고                            |
| ------ | ------------------------------- | ----------------------------- |
| API 경로 | `getPensionStatus` 함수 내부        | 파라미터 처리 또는 응답 오류 가능성          |
| 에러 로그  | Azure 로그 / `console.error`      | Stack trace 확인 필요             |
| 호출 방법  | `fetchPensionInfo` headers/body | GET/POST 및 content-type 확인 필요 |
| 환경 상태  | 로컬 실행 대비 Azure 상 차이             | 인증키, 파라미터명, JSON 포맷 등         |

---

## 🛠️ 작업 지시사항

1. \`\`\*\* 함수 내부 500 오류 발생 조건 확인\*\*
2. `fetchPensionInfo`의 호출 방식(`GET`/`POST`, 파라미터 encoding 등) 점검
3. UI 렌더링 시점에서 함수 응답을 제대로 수신하는지 `console` 및 네트워크 탭 확인
4. 함수 테스트용 코드에서 정상 응답이 있었던 요청과 비교 분석
5. UI에서 사용되는 `defaultBizNo` 값이 빈 값 또는 유효하지 않은 형식인지 여부 확인

---

## 📂 관련 세션 및 문서

* 세션: `Session_20250619_Masking_OK` (이전 함수 기준 확립됨)
* 관련 요청서: `요청서_20250619_014` (함수 정리), `요청서_20250618_009` (UI 삽입)

---

> 🎯 본 요청서는 함수 오류로 인해 중단되었던 UI 흐름을 복구하고, 국민연금 정보 블럭의 정상 작동을 목표로 함. 함수 단건 호출 기준은 확립되었으므로, UI 연동 로직에서의 오류 조건을 파악하고 최종 복구를 지시함.

네, 유비님.
이제 다시 정확히 정리하면 — **모든 설정을 마쳤음에도 불구하고** Azure Function에서 여전히 **SOAP Fault XML 응답 + 500 오류**가 발생하고 있다는 점은 아주 명확합니다.

---

## ❗ 현재 상황 핵심 요약

| 항목                         | 상태                                                                                   |
| -------------------------- | ------------------------------------------------------------------------------------ |
| Azure 배포 성공                | ✅                                                                                    |
| 환경변수(`PENSION_API_KEY`) 설정 | ✅ 정상 설정됨                                                                             |
| 함수 실행 정상                   | ✅ 사용 중 상태, React 연동도 정상 호출                                                           |
| 응답 결과                      | ❌ **여전히 SOAP Fault XML** (즉, `JSON`이 아님)                                             |
| 최종 호출                      | `https://taxcredit-api-func.azurewebsites.net/api/getPensionStatus?bizNo=1018197530` |

---

## 📌 여기서 유일하게 남은 결정적 의심 포인트

> `axios.get(apiUrl, { headers })` 호출 시,
> **공공데이터포털 API가 JSON 응답을 반환하지 않고 SOAP(XML) Fault를 반환하는 이유는**
> → **요청 헤더 구조가 서버에서 여전히 올바르게 해석되지 않고 있기 때문입니다.**

---

## ✅ 점검 2포인트 (최종 단계)

### 🔹1. `User-Agent`, `Accept`, `Content-Type`을 **모두 명시했는가?**

공공데이터포털 일부 API는 다음 헤더가 없으면 SOAP로 자동 fallback됩니다:

```js
const headers = {
  'User-Agent': 'Mozilla/5.0',
  'Accept': 'application/json',
  'Content-Type': 'application/json',
};
```

> `Accept`와 `Content-Type`을 함께 명시해줘야 확정적으로 JSON 응답을 유도할 수 있습니다.

---

### 🔹2. 로그에서 실제 `axios.get()`에 넘긴 URL과 헤더가 보이도록 `console.log` 했는가?

Azure에선 로컬과 다르게 **기본 헤더가 생략되거나**
`axios` 내부에서 Content-Negotiation 실패하는 경우가 있어
→ 실제 **console.log(headers)** 값이 중요한 확인 지점입니다.

---

## 🧾 Cursor에게 다시 지시할 요청문 (복붙용)

````md
❗ 아직도 공공데이터포털 API 호출 시 SOAP Fault가 반환되고 있습니다.
✅ _type=json도 포함되어 있고, API 키도 정확하지만_, JSON 응답으로 전환되지 않고 있음

다음 2가지를 반드시 확인해서 반영해 주세요:

1. 호출 시 axios.get(..., { headers }) 내부의 headers를 다음처럼 지정할 것:

```js
const headers = {
  'User-Agent': 'Mozilla/5.0',
  'Accept': 'application/json',
  'Content-Type': 'application/json'
};
````

2. 실제 전달되는 headers를 Azure 콘솔 로그에서 확인 가능하도록 다음 로그를 반드시 출력할 것:

```js
context.log.info("📦 호출 헤더:", JSON.stringify(headers, null, 2));
```

이 문제는 헤더가 충분하지 않아서 JSON 응답이 아닌 SOAP XML Fault로 fallback 되는 전형적인 구조입니다.

```

